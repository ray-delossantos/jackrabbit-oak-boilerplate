<!--/*
    VENTURE Publish Date Component
    Formatted date display with multiple formats
*/-->
<sly data-sly-use.properties="org.apache.sling.api.resource.ValueMap"></sly>

<time class="venture-date ${properties.style || 'venture-date--default'}"
      datetime="${properties.date}"
      data-sly-test="${properties.date}">
    <span class="venture-date__text"
          data-sly-test="${properties.format == 'relative'}"
          data-date="${properties.date}">
        <!-- Will be updated by JS for relative time -->
        ${properties.date}
    </span>
    <span class="venture-date__text"
          data-sly-test="${properties.format != 'relative'}">
        ${properties.formattedDate || properties.date}
    </span>
</time>

<style>
.venture-date {
    font-size: 0.875rem;
    color: #6c757d;
}

.venture-date--default {
    /* Standard date display */
}

.venture-date--compact {
    font-size: 0.75rem;
}

.venture-date--large {
    font-size: 1rem;
    font-weight: 500;
}

.venture-date--accent {
    color: var(--venture-coral, #FF6B6B);
    font-weight: 600;
}

.venture-date--with-icon::before {
    content: "";
    display: inline-block;
    width: 14px;
    height: 14px;
    margin-right: 0.375rem;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%236c757d' stroke-width='2'%3E%3Crect x='3' y='4' width='18' height='18' rx='2' ry='2'/%3E%3Cline x1='16' y1='2' x2='16' y2='6'/%3E%3Cline x1='8' y1='2' x2='8' y2='6'/%3E%3Cline x1='3' y1='10' x2='21' y2='10'/%3E%3C/svg%3E");
    background-size: contain;
    vertical-align: middle;
}
</style>

<script>
// Relative time formatting
(function() {
    const relativeDates = document.querySelectorAll('.venture-date [data-date]');

    relativeDates.forEach(function(el) {
        const date = new Date(el.dataset.date);
        const now = new Date();
        const diffMs = now - date;
        const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));

        let text;
        if (diffDays === 0) {
            text = 'Today';
        } else if (diffDays === 1) {
            text = 'Yesterday';
        } else if (diffDays < 7) {
            text = diffDays + ' days ago';
        } else if (diffDays < 30) {
            const weeks = Math.floor(diffDays / 7);
            text = weeks + (weeks === 1 ? ' week ago' : ' weeks ago');
        } else if (diffDays < 365) {
            const months = Math.floor(diffDays / 30);
            text = months + (months === 1 ? ' month ago' : ' months ago');
        } else {
            const years = Math.floor(diffDays / 365);
            text = years + (years === 1 ? ' year ago' : ' years ago');
        }

        el.textContent = text;
    });
})();
</script>
