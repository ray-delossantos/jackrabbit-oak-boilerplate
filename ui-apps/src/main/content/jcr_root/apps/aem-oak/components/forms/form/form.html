<!--/*
    VENTURE Form Component
    Form container with validation and submission
*/-->
<sly data-sly-use.form="com.aem.oak.models.forms.FormModel"></sly>

<form class="venture-form ${form.styleClass}"
      id="${form.formId}"
      action="${form.action}"
      method="${form.method}"
      name="${form.name}"
      data-validation="${form.clientValidation}"
      data-redirect="${form.redirectUrl}"
      novalidate>

    <!-- Form Fields Container -->
    <div class="venture-form__fields">
        <sly data-sly-resource="${'fields' @ resourceType='wcm/foundation/components/parsys'}"></sly>
    </div>

    <!-- Submit Button -->
    <div class="venture-form__actions">
        <button type="submit" class="venture-btn ${form.submitButtonClass}">
            <span class="venture-form__submit-text">${form.submitButtonText}</span>
            <span class="venture-form__submit-loading" style="display: none;">
                <svg class="venture-spinner" viewBox="0 0 24 24" width="20" height="20">
                    <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="3" fill="none" stroke-dasharray="31.4" stroke-dashoffset="10"/>
                </svg>
            </span>
        </button>
    </div>

    <!-- Messages -->
    <div class="venture-form__messages">
        <div class="venture-form__success" style="display: none;">
            ${form.successMessage}
        </div>
        <div class="venture-form__error" style="display: none;">
            ${form.errorMessage}
        </div>
    </div>
</form>

<style>
.venture-form {
    max-width: 600px;
}

.venture-form__fields {
    display: flex;
    flex-direction: column;
    gap: 1.25rem;
}

/* Default Style */
.venture-form--default .venture-form__fields {
    gap: 1.25rem;
}

/* Compact Style */
.venture-form--compact .venture-form__fields {
    gap: 0.75rem;
}

.venture-form--compact .venture-field input,
.venture-form--compact .venture-field textarea,
.venture-form--compact .venture-field select {
    padding: 0.5rem 0.75rem;
    font-size: 0.875rem;
}

/* Inline Style */
.venture-form--inline {
    max-width: none;
}

.venture-form--inline .venture-form__fields {
    flex-direction: row;
    flex-wrap: wrap;
    align-items: flex-end;
}

.venture-form--inline .venture-field {
    flex: 1;
    min-width: 200px;
}

.venture-form--inline .venture-form__actions {
    margin-top: 0;
}

/* Floating Labels Style */
.venture-form--floating .venture-field {
    position: relative;
}

.venture-form--floating .venture-field__label {
    position: absolute;
    left: 1rem;
    top: 50%;
    transform: translateY(-50%);
    transition: all 0.2s ease;
    pointer-events: none;
    color: #6c757d;
    margin: 0;
}

.venture-form--floating .venture-field input:focus + .venture-field__label,
.venture-form--floating .venture-field input:not(:placeholder-shown) + .venture-field__label {
    top: 0;
    font-size: 0.75rem;
    background: #fff;
    padding: 0 0.25rem;
}

/* Actions */
.venture-form__actions {
    margin-top: 1.5rem;
}

.venture-form__submit-loading {
    display: inline-flex;
    align-items: center;
}

.venture-spinner {
    animation: spin 1s linear infinite;
}

@keyframes spin {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}

/* Messages */
.venture-form__messages {
    margin-top: 1rem;
}

.venture-form__success {
    padding: 1rem;
    background: #d4edda;
    color: #155724;
    border-radius: 4px;
}

.venture-form__error {
    padding: 1rem;
    background: #f8d7da;
    color: #721c24;
    border-radius: 4px;
}
</style>

<script>
(function() {
    const forms = document.querySelectorAll('.venture-form');

    forms.forEach(function(form) {
        const validation = form.dataset.validation !== 'false';
        const redirectUrl = form.dataset.redirect;
        const submitBtn = form.querySelector('button[type="submit"]');
        const submitText = form.querySelector('.venture-form__submit-text');
        const submitLoading = form.querySelector('.venture-form__submit-loading');
        const successMsg = form.querySelector('.venture-form__success');
        const errorMsg = form.querySelector('.venture-form__error');

        form.addEventListener('submit', function(e) {
            e.preventDefault();

            // Client-side validation
            if (validation && !form.checkValidity()) {
                form.reportValidity();
                return;
            }

            // Show loading state
            submitBtn.disabled = true;
            submitText.style.display = 'none';
            submitLoading.style.display = 'inline-flex';
            successMsg.style.display = 'none';
            errorMsg.style.display = 'none';

            // Submit form
            const formData = new FormData(form);

            fetch(form.action, {
                method: form.method,
                body: formData
            })
            .then(function(response) {
                if (response.ok) {
                    if (redirectUrl) {
                        window.location.href = redirectUrl;
                    } else {
                        successMsg.style.display = 'block';
                        form.reset();
                    }
                } else {
                    throw new Error('Form submission failed');
                }
            })
            .catch(function(error) {
                errorMsg.style.display = 'block';
            })
            .finally(function() {
                submitBtn.disabled = false;
                submitText.style.display = 'inline';
                submitLoading.style.display = 'none';
            });
        });
    });
})();
</script>
